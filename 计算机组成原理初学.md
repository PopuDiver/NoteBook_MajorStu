# 第一章 概论

## 前期的不知道知识点

![image-20221010201651887](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030932402.png)

![image-20221010201703165](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030932105.png)

## 存储器的容量

MAR的位数反映存储单元数量，MDR反映每个存储单元大小。(MAR是地址存储，MDR是数据存储)

## CPU的性能指标

CLK的一个循环周期叫做==CPU的时钟周期==

==CPU主频(时钟频率)== = 1 / CPU时钟周期；

==CPI==(Clock cycle Per Instruction)：执行一条指令所需的时钟周期数  	不同的指令，CPI不同，甚至相同的指令，CPI也可能有变化

==执行一条指令的耗时== = CPI × CPU时钟周期

==CPU执行时间== = CPU时钟周期数 / 主频 = (指令条数 * CPI) / 主频

==IPS==(Instructions Per Second) : 每秒执行多少条指令 	IPS = 主频 / 平均CPI

==FLOPS==(Floating-point Operations Per Second) : 每秒执行多少次浮点运算

注：此处K、M、G、T为数量单位

描述存储容量、文件大小时：K = 2^10^ , M = 2^20^ ,G = 2^30^ ,T = 2^40^ 

描述频率、速率时：K = Kilo = 千 = 10^3^ , M = Million = 百万 = 10^6^ , G = Giga = 十亿 = 10^9^ , T = Tera = 万亿 = 10^12^ 

## 系统整体的性能指标

数据通路带宽：数据总线一次所能并行传送信息的位数(各硬件部件通过数据总线传输数据)

吞吐量：指系统在单位时间内处理请求的数量。 

​		它取决于信息能多快地输入内存，CPU能多快地取指令，数据能多快地从内存取出或存入，以及所得结果能多快地从内存送给一台外部设备。这些步骤中的每一步都关系到主存，因此，系统吞吐量主要取决于主存的存取周期。

响应时间：指从用户向计算机发送一个请求，到系统对该请求做出响应并获得它所需要的结果的等待时间。通常包括CPU时间(运行一个程序所花费的时间)与等待时间(用于磁盘访问、存储器访问、I/O操作、操作系统开销等时间)。

## 系统整体的性能指标(动态测试)

基准程序是用来测量计算机1处理速度的一种实用程序，以便于被测量的计算机性能可以与运行相同程序的其它计算机性能进行比较。

# 第二章 数据的表示与计算

![image-20221011085958903](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030932640.png)

## BCD码

BCD：Binary-Coded Decimal,用二进制编码的十进制

### 8421码

8421码每一位都有权值 对应四位 8 4 2 1 ，所以叫有权码。

8421码的映射关系：每四位对应一个十进制位，可以进行快速转换

8421码中1010~1111没有定义，所以在8421码定义中会先加6(0110)进行修正，然后成为最终结果。

### 余3码

无权码，没有对应权值。

8421码 + (0011)~2~ 

### 2421码

改变权值定义 有权码 对应 2 4 2 1

表示 0~4 时最高位为0，表示 5~9 时最高位为1

## 字符与字符串

### 英文字符在计算机内的表示

![image-20221011095155669](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030932989.png)

### 中文字符在计算机内的表示

GB 2312-80：汉字 + 各种符号共7445个

​		区位码：94个区，每区94个位置

### 字符串的存储

常采用'\0'作为字符串结束标志

![image-20221011103404654](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030933189.png)

## 奇偶校验码

### 校验原理

由若干位代码组成的一个字叫做==码字==。

将两个码字逐位进行对比，具有不同的位的个数称为==两个码字间的距离==。

一种编码方案可能有若干个合法码字，各合法码字间的最小距离称为==码距==。

当d = 1时，无检错能力；当d = 2时，有检错能力；当d >= 3时，若设计合理，可能具有检错、纠错能力

### 奇偶校验

偶校验的硬件实现：各信息进行异或(模2加)运算，得到的结果即为偶校验位

进行偶校验，所有位进行异或，若结果为1说明出错

![image-20221011110820233](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030933710.png)

## 海明校验码

奇校验码：整个校验码(有效信息位和校验位)中“1”的个数为奇数。

偶校验码：整个校验码(有效信息位和校验位)中“1”的个数为偶数。

偶校验：1010 -> 01010,能发现奇数位错误，但无法确定是哪一位出错。

海明码设计思路：将信息位分组进行偶校验 -> 多个校验位 -> 多个校验位标注出错位置

1.需要多少校验位？

​		信息位n 	校验位k 	-> 	2^k^种状态	(信息位加校验位，共n+k位)	-> 	2^k^ >= n+k+1

2.确定校验位的分布

​		校验位P~i~放在海明位号位2^i-1^的位置上，信息位按顺序放到其余位置

3.求校验位的值

​		使用偶校验的方法进行求值

![image-20221011125237169](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030934348.png)

## 循环冗余校验码(CRC码)

循环冗余校验码(Cyclic Redundancy Check,CRC)

### CRC码的基本思想

数据发送、接受方约定一个“==除数==”

==K个信息位 + R个校验位==作为“==被除数==”，添加校验位后需保证==除法==的余数为0

收到数据后，进行除法检查余数是否为0

若余数非0说明出错，则进行重传或纠错

### 如何构造

![image-20221011131607419](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081259607.png)

对应二进制码为：G(x) = 1 * x^3^ + 1 * x^2^ + 0 *x + 1;所以二进制码为1101。

### 如何检错纠错

![image-20221011132056719](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300231.png)

![image-20221011181301851](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300689.png)

## 定点数的表示

定点数：小数点的位置固定

浮点数：小数点的位置不固定

## 原码

用尾数表示真值的绝对值，符号位“0/1”对应“正/负”

## 反码

若原码符号位为0，则反码与原码相同；若符号位为1，则数值位全部取反。

## 补码

正数的补码 = 原码；负数的补码 = 反码末位 + 1	(要考虑进位)。

## 移码

补码的基础上将符号位取反。注意：移码只能用于表示整数。

![image-20221011190704544](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300441.png)

![image-20221011191048545](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300906.png)

移码很方便进行表示的整数比较大小。

## 移位运算

### 原码的算术移位 

 符号位保持不变，仅对数值位进行移位。

右移：高位补0，低位舍弃。若舍弃的位 = 0，则相当于 / 2；若舍弃的位 不等于 0，则会丢失精度。

左移：低位补0，高位舍弃。若舍弃的位 = 0，则相当于 * 2；若舍弃的位 不等于 0，则会出现严重误差。

### 反码的算术移位

正数的反码与原码相同，因此对正数反码的移位运算也和原码相同。

右移：高位补0，低位舍弃。

左移：低位补0，高位舍弃。

负数的反码数值位与原码相反，因此负数反码的移位运算规则如下，

右移：高位补1，低位舍弃。

左移：低位补1，高位舍弃。

### 移码的算术移位

正数的反码与原码相同，因此对正数反码的移位运算也和原码相同。

右移：高位补0，低位舍弃。

左移：低位补0，高位舍弃。

负数补码 = 反码末尾 + 1导致反码最右边几个连续的1都因进位而变为0，直到进位碰到第一个0为止。

==规律 -- 负数补码中，最右边的1及其右边同原码。最右边的1的左边同反码==。

右移（同反码）：高位补1，低位舍弃。

左移（同原码）：低位补0，高位舍弃。

## 加减运算

### 原码的加减运算

![image-20221015181411504](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300781.png)

### 补码的加减运算

负数补 -> 原 ： 1.数值位取反+1；2.负数补码中，最右边的1及其右边同原码，最右边的1的左边同反码。

对于补码来说，无论加法还是减法，最后都会转变成加法，由加法器实现运算，符号位也参与运算。

### 溢出判断

只有正数 + 正数才会上溢 -- 正 + 正 = 负

只有负数 + 负数才会下溢 -- 负 + 负 = 正 

## 手算乘法

![image-20221017205125119](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300950.png)

## 原码除法

![image-20221018162559481](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300116.png)

## 补码除法 

![image-20221018164504605](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300454.png)

## 强制类型转换

![image-20221018171548772](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300764.png)

## 边界对齐

![image-20221018172936605](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300912.png)

## 浮点数的表示

![image-20221018175038786](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300790.png)

### 浮点数尾数的规格化

规格化浮点数：规定==尾数的最高数值位必须是一个有效值==。

**左规**：当浮点数运算的结果为非规格化时要进行规格化处理，将==尾数算数左移一位，阶码减一==。

**右规**：当浮点数运算的结果尾数出现溢出(双符号位为01或10)时，将==尾数算数右移一位，阶码加一==。

注：采用双符号位，当溢出发生时，可以挽救。更高的符号位是正确的符号位。

![image-20221018175511490](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300741.png)

### 规格化浮点数的特点

1.用原码表示的尾数进行规格化：

正数为0.1 X....XX的形式，其最大值表示为0.11...1;最小值表示为0.10....0。尾数的表示范围为1/2 <= M  <= (1 - 2^-n^) 。

负数为1.1 X....XX的形式，其最大值表示为1.10...0;最小值表示为1.11....1。尾数的表示范围为-(1 - 2^-n^) <= M  <=  -1/2。

2.用补码表示的尾数进行规格化：

正数为0.1 X....XX的形式，其最大值表示为0.11...1;最小值表示为0.10....0。尾数的表示范围为1/2 <= M  <= (1 - 2^-n^) 。

负数为1.0 X....XX的形式，其最大值表示为1.01...1;最小值表示为1.00....0。尾数的表示范围为-1 <= M  <=  -(1/2 + 2^-n^)。

==规格化的原码尾数，最高位数值位一定是1。规格化的补码尾数，符号位与最高数值位一定相反==。

注：补码算数左移，低位补0；补码算数右移，高位补1。

浮点数的表示：

![image-20221018194343506](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300648.png)

## 移码2

移码的定义：移码 = 真值 + 偏置值

### IEEE 754标准

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081300617.png)

IEEE 754单精度浮点型能表示的最小绝对值和最大绝对值：

最小绝对值：尾数全为0，阶码真值最小-126，对应移码机器数 0000 0001 此时整体的真值为(1.0)~2~ * 2^-126^ 

最大绝对值：尾数全为1，阶码真值最大127，对应移码机器数 1111 1110 此时整体的真值为(1.111...111)~2~ * 2^127^ 

![image-20221018202513326](C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20221018202513326.png)

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301602.png" alt="image-20221018202612768" style="zoom: 67%;" />

![](C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20221018203023023.png)

![image-20221018203310548](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301824.png)

## 浮点数的加减运算

浮点数加减运算步骤：

1.对阶

2.尾数加减

3.规格化

4.舍入

5.判溢出

![image-20221019184554693](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301927.png)

## 算数逻辑单元

![image-20221019195510769](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301687.png)

# 第三章 存储系统

## 存储系统基本概念

### 半导体随机存取存储器

![image-20221022160821388](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301958.png)

![image-20221023075737710](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301276.png)

### RAM易失性存储器

![image-20221022162052342](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301841.png)

![image-20221022162726603](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301519.png)

![image-20221022162628892](C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20221022162628892.png)

### 存储器的分类

![image-20221023080624617](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301760.png)

### 存储器的性能指标

1.存储容量：存储字数 × 字长(如1M × 8位)。

2.单位成本：每位价格 = 总成本 / 总容量。

3.存储速度：数据传输率 = 数据的宽度 / 存储周期。

### 本章小结：

![image-20221023081926902](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301219.png)

## 主存和CPU的连接

 ### 主存容量扩展-字扩展

线选法和译码片选法

![image-20221023085606974](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301842.png)

![image-20221023085940045](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301614.png)

### 双端口RAM

两个端口对同一主存操作有以下4种情况：

1.两个端口不同时对同一地址单元存取数据。  		（√）

2.两个端口同时对同一地址单元读出数据。				（√）

3.两个端口同时对同一地址单元写入数据。																	 	写入错误

4.两个端口同时对同一地址单元，一个写入数据，另一个读出数据。							读出错误

![image-20221023151907404](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301132.png)

## 高速缓冲存储器-局部性原理性能分析

## Cache的基本工作原理

1.主存中的块放到Cache中哪个位置？

​		1）空位随意放：全相联映射

​		2）对号入座：直接映射

​		3）按号分组，组内随意放：组相联映射

2.对于1），Cache满了如何处理？对于2）3），对应位置被占用如何处理？

​		随机(RAND)算法，先进先出(FIFO)算法，近期最少使用(LRU)算法，最不经常使用(LFU)算法。

3.修改Cache中的内容后，如何保持主存中相应内容的一致性？

​		命中：全写法(write-through)

​					写回法(write-back)

​		未命中：写分配法(write-allocate)

​						非写分配法(not-write-allocate)

# 第四章 指令系统

## 指令格式

## CISC 和 RISC

![image-20221028185942066](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081301003.png)

![image-20221028190245432](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302406.png)



本章小结：

![image-20221028190936203](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302591.png)

# 第五章 中央处理器

![image-20221029073110461](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302413.png)

## CPU的功能和基本结构

### CPU的功能

1.指令控制。

​	完成取指令、分析指令和执行指令的操作，即程序的顺序控制。

2.操作控制。

​	一条指令的功能往往是由若干操作信号的组合来实现的。CPU管理并产生由内存取出的每条指令的操作信号，把各种操作信号送往相应的部件，从而控制这些部件按指令的要求进行动作。

3.时间控制。

​	对各种操作加以时间上的控制。时间控制要为每条指令按时间顺序提供应有的控制信号。

4.数据加工。

​	对数据进行算术和逻辑运算。

5.中断处理。

​	+计算机运行过程中出现的异常情况和特殊请求进行处理。

### 运算器和控制器的功能

运算器：对数据进行加工

控制器：协调并控制计算机各部件执行程序的指令序列，基本功能包括取指令、分析指令、执行指令。

​				取指令：自动形成指令地址；自动发出取指令的命令。

​				分析指令：操作码译码（分析本条指令要完成什么操作）；产生操作数的有效地址。

​				执行指令：根据分析指令得到的“操作命令”和“操作数地址”，形成操作信号控制序列，控制运算器、存储器以及I/O设备完成相应的操作。

​				中断处理：管理总线及输入输出；处理异常情况（如掉电）和特殊请求（如打印机请求打印一行字符）。

### 运算器的基本结构

1.算术逻辑单元：主要功能是进行算术/逻辑运算。

2.通用寄存器组：如AX、BX、CX、DX、SP等，用于存放操作数（包括源操作数、目的操作数及中间结果）和各种地址信息等。SP是堆栈指针，用于指示栈顶的地址。

专用数据通路方式：根据指令执行过程中的数据和地址的流动方向安排连接线路。

如果直接用导线连接，相当于多个寄存器同时并且一直向ALU传输数据

​	解决方法1：使用多路选择器 根据控制信号选择一路输出

​	解决方法2：使用三态门 可以控制每一路是否输出。

性能较高，基本不存在数据冲突现象，但结构复杂，硬件量大，不易实现。

CPU内部单总线方式：将所有寄存器的输入端和输出端都连接到一条公共的通路上。

3.暂存寄存器：用于暂存从主存读来的数据，这个数据不能存放在通用寄存器中，否则会破坏其原有内容。

4.累加寄存器：它是一个通用寄存器，用于暂时存放ALU运算的结果信息，用于实现加法运算。

5.程序状态字寄存器：保留由算术逻辑运算指令或测试指令的结果而建立的各种状态信息，如溢出标志（OP）、符号标志（SF）、零标志（ZF）、进位标志（CF）等。PSW中的这些位参与并决定微操作的形成。

6.移位器：对运算结果进行移位运算。

7.计数器：控制乘除运算的操作步数。

### 控制器的基本结构

1.程序计数器：用于指出下一条指令在主存中的存放地址。CPU就是根据PC的内容去主存中取指令的。因程序中指令（通常）是顺序执行的，所以PC有自增功能。

2.指令寄存器：用于保存当前正在执行的那条指令。

3.指令译码器：仅对操作码字段进行译码，向控制器提供特定的操作信号。

4.微操作信号发生器：根据IR的内容（指令）、PSW的内容（状态信息）及时序信号，产生控制整个计算机系统所需的各种控制信号，其结构有组合逻辑型和存储逻辑型两种。

5.时序系统：用于产生各种时序信号，它们都是由统一时钟（CLOCK）分频得到。

6.存储器地址寄存器：用于存放所要访问的主存单元的地址。

7.存储器数据寄存器：用于存放向主存写入的信息或从主存中读出的信息。

### 本章小结：



![image-20221029072914063](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302237.png)

## 指令执行过程

### 指令周期

CPU从主存中每取出并执行一条指令所需的全部时间。

指令周期常常用若干机器周期来表示，机器周期又叫CPU周期。

一个机器周期又包含若干时钟周期（也称为节拍、T周期或CPU时钟周期，它是CPU操作的最基本单位）。

每个指令周期内机器周期数可以不等，每个机器周期内的节拍数也可以不等。

### 指令周期流程

取指周期->有无间址(有就执行间址周期，无则继续下一步)->执行周期->有无中断(有即执行，无则继续)->进入取指周期

使用触发器判断处于哪一个阶段，触发器可以存放一个二进制位，在执行哪个周期，为1，否则为0。

四个工作周期都有CPU访存操作，只是访存的目的不同。取指周期是为了取指令，间址周期是为了取有效地址，执行周期是为了取操作数，中断周期是为了保存程序断点。

### 指令周期的数据流--取指周期

1.当前指令地址送至存储器地址寄存器，记作：(PC)->MAR

2.CU发出控制信号，经控制总线传到主存，这里是读信号，记作：1->R

3.将MAR所指主存中的内容经数据总线送入MDR，记作：M(MAR)->MDR

4.将MDR中的内容（此时是指令）送入IR，记作：(MDR)->IR

5.CU发出控制信号，形成下一条指令地址，记作：(PC) + 1 -> PC

### 指令周期的数据流--间址周期

1.将指令的地址码送入MAR，记作：Ad(IR) -> MAR 或 Ad(MDR) -> MAR

2.CU发出控制信号，启动主存做读操作，记作：1 -> R

3.将MAR所指内存中的内容经数据总线送入MDR，记作：M(MAR) -> MDR

//4.将有效地址送至指令的地址码字段，记作：MDR -> Ad(IR)

### 指令周期的数据流--执行周期

执行周期的任务是根据IR中的指令字的操作码和操作数通过ALU操作产生执行结果。不同指令的执行周期操作不同，因此没有统一的数据流向。

### 指令周期的数据流--中断周期

中断：暂停当前任务去完成其它任务。为了能够恢复当前任务，需要保存断点。一般使用堆栈来保存断点，这里用SP表示栈顶地址，假设SP指向栈顶元素，进栈操作是先修改指针，后存入数据。

1.CU控制将SP减1，修改后的地址送入MAR 记作： (SP) - 1 -> SP,(SP) -> MAR

本质上是将断点存入某个存储单元，假设其地址为a，故可记作：a -> MAR

2.CU发出控制信号，启动主存做写操作，记作：1 -> W

3.将断点(PC内容)送入MDR，记作：(PC) -> MDR

4.CU控制将中断服务程序的入口地址(由向量地址形成部件产生)送入PC，记作：向量地址 -> PC

### 指令执行方案

一个指令周期通常要包括几个时间段(执行步骤)，每个步骤完成指令的一部分功能，几个依次执行的步骤完成这条指令的全部功能。

方案1.单指令周期

​	对所有指令都选用相同的执行时间来完成。指令之间串行执行；指令周期取决于执行时间最长的指令的执行时间。

​	对于那些本来可以在更短时间内完成的指令，要使用这个较长的周期来完成，会降低整个系统的运行速度。

方案2.多指令周期

​	对不同类型的指令选用不同的执行步骤来完成。指令之间串行执行；可选用不同个数的时钟周期来完成不同指令的执行过程。需要更复杂的硬件设计。

方案3.流水线方案

​	在每一个时钟周期启动一条指令，尽量让多条指令同时运行，但各自处在不同的执行步骤中。指令之间并行执行。

### 本章小结：

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302759.png)

## 数据通路的功能和基本结构--单总线

数据通路：数据在功能部件之间传送的路径。		信息从哪里开始，中间经过哪些部件，最后传到哪里。

​	由控制部件产生的控制信号建立数据通路。

数据通路的基本结构：

​	1.CPU内部单总线方式。

​	2.CPU内部多总线方式。

​	3.专用数据通路方式。

### 数据通路-CPU内部单总线方式

内部总线是指同一部件，如CPU内部连接各寄存器及运算部件之间的总线；

系统总线是指同一台计算机系统的各部件，如CPU、内存、通道和各类I/O接口间互相连接的总线。

1.寄存器之间数据传送

​	比如把PC内容送至MAR,实现传送操作的流程及控制信号为：(PC) -> Bus		PCout有效，PC内容送总线	

​																												  Bus -> MAR	   MARin有效，总线内容送MAR

2.主存与CPU之间的数据传送

​	比如CPU从主存读取指令，实现传送操作的流程及控制信号为：

​																		(PC) -> Bus -> MAR		PCout和MARin有效，现行指令地址 -> MAR				

​																		1 -> R								CU发读命令(通过控制总线发出)			

​																		MEM(MAR) -> MDR	  MDRin有效		

​																		MDR -> Bus -> IR		   MDRout和MDRin有效，现行指令 -> IR

3.执行算术或逻辑运算

​	比如一条加法指令，微操作序列及控制信号为：Ad(IR) -> Bus -> MAR			MDRout和MARin有效 或 AdIRout和MARin有效

​																							1 -> R										CU发读命令

​																							MEM(MAR) -> 数据线 -> MDR 	MDRin有效

​																							MDR -> Bus -> Y  							MDRout和Yin有效，操作数 -> Y

​							    															(ACC) + (Y) -> Z								ACCout和ALUin有效，CU向ALU发送加命令

​																							Z -> ACC											Zout和ACCin有效，结果 -> ACC

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302801.png)

### 本章小结：

![image-20221029094258662](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302773.png)

## 专用数据通路-取指周期

 ![image-20221029095022890](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302195.png)

### 本章小结

![image-20221029101310009](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302436.png)

## 控制器的结构和功能

![image-20221029155434617](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081310472.png)

控制器是计算机系统的指挥中心，控制器的主要功能有：

​	1.从主存中取出一条指令，并指出下一条指令在主存中的位置。

​	2.对指令进行译码或测试，产生相应的操作控制信号，以便启动规定的动作。

​	3.指挥并控制CPU、主存、输入和输出设备之间的数据流动方向。

### 控制单元的输入输出

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302082.png)

### 硬布线控制器

![image-20221029160734667](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302335.png)

### CPU的控制方式

产生不同微操作命令序列所用的时序控制方式。

1.同步控制方式

整个系统所有的控制信号均来自一个==统一的时钟信号==。

通常以最长的微操作序列和最烦琐的微操作作为标准，采取完全统一的、具有相同时间间隔和相同数目的节拍作为机器周期来运行不同的指令。同步控制方式的优点是控制电路简单，缺点是运行速度慢。

2.异步控制方式

异步控制方式==不存在基准时标信号==。

各部件按自身固有的速度工作，通过==应答方式==进行联络。

异步控制方式的优点是运行速度快，缺点是控制电路比较复杂。

3.联合控制方式

对各种不同的指令的微操作实行==大部分采用同步控制、小部分采用异步控制==的方法。

设计步骤：

​	1.分析每个阶段的微操作序列

​	2.选择CPU的控制方式

​	3.安排微操作时序

​	4.电路设计

假设采用同步控制方式，一个机器周期内安排三个节拍（时钟周期）。

### 安排微操作时序的原则

原则一	微操作的先后顺序不得随意更改

原则二	被控对象不同的微操作，尽量安排在一个节拍内完成

原则三	占用时间较短的微操作，尽量安排在一个节拍内完成，并允许有先后顺序



![image-20221029163722030](C:/Users/DELL/AppData/Roaming/Typora/typora-user-images/image-20221029163722030.png)

### 组合逻辑设计

设计步骤：

1.列出操作时间表

2.写出微操作命令的最简表达式

3.画出逻辑图

![image-20221030080308423](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302412.png)

![image-20221030080447632](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302378.png)

![image-20221030080750750](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302325.png)

### 微操作信号综合

![image-20221030081040797](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302297.png)

### 本章小结

![image-20221030081520583](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302340.png)

## 控制器的功能和工作原理-微程序

### 控制器的设计思路

硬布线工作原理：微操作控制信号由组合逻辑电路根据当前的指令码、状态和时序，即时产生

微程序工作原理：事先把微操作控制信号存储在一个专门的存储器（控制存储器）中，将每一条机器指令编写成一个微程序，这些微程序可以存到一个控制存储器中，用寻址用户程序机器指令的办法来寻址每个微程序中的微指令。

### 微程序的基本思想

![image-20221030084054826](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303275.png)

### 微程序控制器的基本结构

![image-20221030084544824](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081302127.png)

### 控制存储器

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303051.png)

### 微指令的格式

1.水平型微指令：基本格式 操作控制  顺序控制

微指令的编码方式又称为微指令的控制方式，它是指如何对微指令的控制字段进行编码，以形成控制信号。编码的目标是在保证速度的情况下，尽量缩短微指令字长。

​	一次能定义并执行多个并行操作

​	优点：微程序短，执行速度快；

​	缺点：微指令长，编写微程序较麻烦

​	1）直接编码（直接控制）方式

​		在微指令的操作控制字段中，每一位代表一个微操作命令，某位为1表示该控制信号有效

​		优点：简单、直观，执行速度快，操作并行性好。

​		缺点：微指令字长过长，n个微命令就要求微指令的操作字段有n位，造成控存容量极大。

​	2）字段直接编码方式

​		将微指令的控制字段分成若干“段”，每段经译码后发出控制信号

​		微命令字段分段的原则：

​			(1)互斥性微命令分在同一段，相容性微命令分在不同段内。

​			(2)每个小段中包含的信息位不能太多，否则将增加译码线路的复杂性和译码时间。

​			(3)一般每个小段还要留出一个状态，表示本字段不发出任何微命令。因此，当某字段的长度为3位时，最多只能表示7个互斥的微命令，通常用000表示不操作。

​			优点：可以缩短微指令字长

​			缺点：要通过译码电路后再发出微命令，因此比直接编码方式慢。

​		3）字段间接编码方式

​			一个字段的某些微命令需由另一个字段中的某些微命令来解释，由于不是靠字段直接译码发出的微命令，故称为字段间接编码，又称隐式编码。

2.垂直型微指令

​	类似机器指令操作码的方式，由微操作码字段规定微指令的功能。

​	优点：微指令短、简单、规整，便于编写微程序；

​	缺点：微程序长，执行速度慢，工作效率低。

3.混合型微指令

​	在垂直型的基础上增加一些不太复杂的并行操作。

​	微指令较短，仍便于编写；微程序也不长，执行速度加快。

### 微指令的地址形成方式

1.微指令的下地址字段指出

​	微指令格式中设置一个下地址字段，由微指令的下地址字段直接指出后继微指令的地址，这种方式又称为断定方式。

2.根据机器指令的操作码形成

​	当机器指令取至指令寄存器后，微指令的地址由操作码经微地址形成部件形成。

3.增量计数器法	(CMAR) + 1 -> CMAR

4.分支转移	转移方式：指明判别条件；转移地址：指明转移成功后的去向。

​		操作控制字段	-	转移方式	-	转移地址

5.通过测试网络

6.由硬件产生微程序入口地址

​	第一条微指令地址	由专门硬件产生

​	中断周期	由硬件产生中断周期微程序首地址

### 微程序控制的基本概念

1.微命令与微操作

​	微命令是微操作的控制信号，微操作是微命令的执行过程。

2.微指令与微周期

​	微指令是若干微命令的集合。

​	微周期通常指从控制存储器中读取一条微指令并执行相应的微操作所需的时间。

3.主存储器与控制存储器

​	主存储器用于存放程序和数据，在CPU外部，用RAM实现；控制存储器(CM)用于存放微程序，在CPU内部，用ROM实现。

4.程序和微程序

​	程序是指令的有序集合，用于完成特定的功能；

​	微程序是微指令的有序集合，一条指令的功能由一段微程序来实现。

![image-20221030112246712](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303822.png)

### 微程序控制单元的设计

设计步骤：

​	1.分析每个阶段的微操作序列

​	2.写出对应机器指令的微操作命令及节拍安排

​		1）写出每个周期所需要的微操作(参照硬布线)

​		2）补充微程序控制器特有的微操作：

​			a.取指周期：

​				Ad(CMDR) -> CMAR

​				OP(IR) -> CMAR

​			b.执行周期：

​				Ad(CMDR) -> CMAR

​	3.确定微指令格式

​		根据微操作个数决定采用何种编码方式，以确定微指令的操作控制字段的位数。由微指令数确定微指令的顺序控制字段的位数。最后按操作控制字段位数和顺序控制字段位数就可确定微指令字长。

​	4.编写微指令码点

​		根据操作控制字段每一位代表的微操作命令，编写每一条微指令的码点。

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303483.png)

### 微程序设计分类

1.静态微程序设计和动态微程序设计

​	静态：微程序无需改变，采用ROM

​	动态：通过改变微指令和微程序改变机器指令，有利于仿真，采用EPROM

2.毫微程序设计

​	毫微程序设计的基本概念

​	微程序设计用微程序解释机器指令

​	毫微程序设计用毫微程序解释微程序

​	毫微指令与微指令的关系好比微指令与机器指令的关系

### 硬布线与微程序的比较

![image-20221031074045957](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303236.png)

### 本章小结

![image-20221031074248358](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303889.png)

## 指令流水线基本概念和性能指标

### 指令流水的定义

一条指令的执行过程可以分成多个阶段(过程)。根据计算机的不同，具体的分法也不同。

取指	-	分析	-	执行

取指：根据PC内容访问主存储器，取出一条指令送到IR中。

分析：对指令操作码进行译码，按照给定的寻址方式和地址字段中的内容形成操作数的有效地址EA，并从有效地址EA中取出操作数。特点：每个阶段用到的硬件不一样。

执行：根据操作码字段，完成指令规定的功能，即把运算结果写到通用寄存器或主存中。 

1.顺序执行方式	总耗时T = n × 3t = 3nt

​	传统冯·诺依曼机采用顺序执行方式，又称串行执行方式。

​	优点：控制简单，硬件代价小。

​	缺点：执行指令的速度较慢，在任何时刻，处理机中只有一条指令在执行，各功能部件的利用率很低。

2.一次重叠执行方式	总耗时T = 3t + (n - 1)×2t = (1 + 2n)t

​	优点：程序的执行时间缩短了1/3，各功能部件的利用率明显提高。

​	缺点：需要付出硬件上较大开销的代价，控制过程也比顺序执行复杂了。

3.二次重叠执行方式	总耗时T = 3t + (n - 1)×t = (2 + n)t

​	与顺序执行方式相比，指令的执行时间缩短近2/3.这是一种理想的指令执行方式，在正常情况下，处理机中同时有3条指令在执行。

注：也可以把每条指令的执行过程分成4个或5个阶段，分成5个阶段是比较常见的做法。

### 流水线的表示方法

![image-20221031081351360](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303652.png)

### 流水线的性能指标

1.吞吐率

​	在单位时间内流水线所完成的任务数量，或是输出结果的数量。 

![image-20221031081850500](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303774.png)

2.加速比

​	完成同样一批任务，==不使用流水线所用的时间与使用流水线所用的时间==之比。

​	设T~0~表示不使用流水线时的执行时间，即顺序执行所用的时间；T~k~表示使用流水线时的执行时间，则计算流水线加速比（S）的基本公式为S = T~0~ / T~k~

![image-20221031082830498](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303332.png)

3.效率

​	流水线的设备利用率称为流水线的效率。

​	在时空图上，流水线的效率定义为==完成n个任务占用的时空区有效面积==与==n个任务所用的时间与k个流水段所围成的时空区总面积==之比。

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303529.png)

### 本章小结

![image-20221031083249987](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303632.png)

## 指令流水线影响因素分类

 ### 机器周期的设置

![image-20221031085117861](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303683.png)

### 影响流水线的因素

1.结构相关(资源冲突)

​	由于多条指令在同一时刻争用同一资源而形成的冲突称为结构相关。

​	解决方法：

​		1）后一相关指令暂停一周期

​		2）资源重复配置：数据存储器 + 指令存储器

2.数据相关(数据冲突)

​	数据相关指在一个程序中，存在必须等前一条指令执行完才能执行后一条指令的情况，则这两条指令即为数据相关。

​	解决方法：

​		1.把遇到数据相关的指令及其后续指令都暂停一至几个时钟周期，直到数据相关问题消失后再继续执行。可分为硬件阻塞(stall)和软件插入“NOP”两种方法。

​		2.数据旁路技术

​		3.编译优化：通过编译器调整指令顺序来解决数据相关。

​	数据的基本操作：读(R)、写(W)

​	冲突的基本类型：RAW、WAR、WAW 

![image-20221031092006242](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303897.png)

3.控制相关(控制冲突)

​	当流水线遇到转移指令和其它改变PC值的指令而造成断流时，会引起控制相关。

​	解决方法：

​		1.尽早判别转移是否发生，尽早生成转移目标地址

​		2.预取转移成功和不成功两个控制流方向上的目标指令

​		3.加快和提前形成条件码

​		4.提高转移方向的猜准率

![image-20221031092322600](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303839.png)

### 流水线的分类

1.部件功能级、处理机级和处理机间级流水线

​	根据流水线使用的级别的不同，流水线可分为部件功能级流水线、处理机级流水线和处理机间流水线。

​	部件功能级流水就是将复杂的算术逻辑运算组成流水线工作方式。例如，可将浮点加法操作分成求阶差、对阶、尾数相加以及结果规格化等4个子过程。

​	处理机级流水是把一条指令解释过程分成多个子程序，如取指、译码、执行、访存及写回5个子过程。

​	处理机间流水是一种宏流水，其中每一个处理机完成某一专门任务，各个处理机所得到的结果需存放在与下一个处理机所共享的存储器中。

2.单功能流水线和多功能流水线

​	==按流水线可以完成的功能==，流水线可分为单功能流水线和多功能流水线。

​	单功能流水线指只能实现一种固定的专门功能的流水线；

​	多功能流水线指通过各段间的不同连接方式可以同时或不同时地实现多种功能的流水线。

3.动态流水线和静态流水线

​	按==同一时间内各段之间的连接方式==，流水线可分为静态流水线和动态流水线。

​	静态流水线指在同一时间内，流水线的各段只能按同一种功能的连接方式工作。

​	动态流水线指在同一时间内，当某些段正在实现某种运算时，另一些段却正在进行另一种运算。这样对提高流水线的效率很有好处，但会使流水线控制变得很复杂。

4.线性流水线和非线性流水线

​	按流水线的==各个功能段之间是否有反馈信号==，流水线可分为线性流水线与非线性流水线。

​	线性流水线中，从输入到输出，每个功能段只允许经过一次，不存在反馈回路。

​	非线性流水线存在反馈回路，从输入到输出过程中，某些功能段将数次通过流水线，这种流水线适合进行线性递归的运算。

### 流水线的多发技术

1.超标量技术

​	每个时钟周期内可并发多条独立指令

​	要配置多个功能部件

​	不能调整指令的执行顺序

​	通过编译优化技术，把可并行执行的指令搭配起来

2.超流水技术

​	在一个时钟周期内再分段(3段)

​	在一个时钟周期内一个功能部件使用多次(3次)

​	不能调整指令的执行顺序

​	靠编译程序解决优化问题

3.超长指令字

​	由编译程序挖掘出指令间潜在的并行性，

​	将多条能并行操作的指令组合成一条

​	具有多个操作码字段的超长指令字(可达几百位)

### 本章小结

![image-20221031095449362](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303428.png)

# 第六章 总线

![image-20221031100045869](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303589.png)

## 总线的概念与分类

总线是一组能为多个部件分时共享的公共信息传送线路。

为什么要用总线？

​	早期计算机外部设备少时大多采用分散连接方式，不易实现随时增减外部设备。

​	为了更好地解决I/O设备和主机之间连接的灵活性的问题，计算机的结构从分散连接发展为总线连接。

共享是指总线上可以挂接多个部件，各个部件之间互相交换的信息都可以通过这组线路分时共享。

分时是指同一时刻只允许有一个部件向总线发送信息，如果系统中有多个部件，则它们只能分时地向总线发送信息。

### 总线的特性

1.机械特性：尺寸、形状、管脚数、排列顺序

2.电气特性：传输方向和有效的电平范围

3.功能特性：每根传输线的功能(地址、数据、控制)

4.时间特性：信号的时序关系

### 总线的分类

1.按数据传输格式

​	==串行总线==

​		优点：只需要一条传输线，成本低廉，广泛应用于长距离传输；应用于计算机内部时，可以节省布线空间。

​		缺点：在数据发送和接收的时候要进行拆卸和装配，要考虑串行-并行转换的问题。

​	==并行总线==

​		优点：总线的逻辑时序比较简单，电路实现起来比较容易。

​		缺点：信号线数量多，占用更多的布线空间；远距离传输成本高昂；由于工作频率较高时，并行的信号线之间会产生严重干扰，对每条线等长的要求也越高，所以无法持续提升工作频率。

​	1）工作频率相同时，串行总线传输速度比并行总线慢，

​	2）并行总线的工作频率无法持续提高，而串行总线可以通过不断提高工作效率来提高传输速度，最终超过并行总线。

2.按总线功能(连接的部件)

​	==片内总线==

​		片内总线是芯片内部的总线。

​		它是CPU芯片内部寄存器与寄存器之间、寄存器与ALU之间的公共连接线。

​	==系统总线==

​		系统总线是计算机系统内各功能部件(CPU、主存、I/O接口)之间相互连接的总线。

​		按系统总线传输信息内容的不同，又可分为3类：数据总线、地址总线和控制总线。

​			//数据总线(DB)：传输各功能部件之间的数据信息，包括指令和操作数；位数(根数)与机器字长、存储字长有关；双向。

​			//地址总线(AB)：传输地址信息，包括主存单元或I/O端口的地址；位数(根数)与主存地址空间大小及设备数量有关；单向。

​			//控制总线(CB)：传输控制信息；一根控制线传输一个信号；有出：CPU送出的控制命令；有入：主存(或外设)返回CPU的反馈信号。

​			1）==数据总线==用来传输各功能部件之间的数据信息，它是双向传输总线，其位数与机器字长、存储字长有关。

​			2）==地址总线==用来指出数据总线上的源数据或目的数据所在的主存单元或I/O端口的地址，它是单向传输总线，地址总线的位数与主存地址空间的大小有关。

​			3）==控制总线==传输的是控制信息，包括CPU送出的控制命令和主存(或外设)返回CPU的反馈信号。

​	==通信总线==

​		通信总线是用于计算机系统之间或计算机系统与其它系统(如远程通信设备、测试设备)之间信息传送的总线，通信总线也称为外部总线。

3.按时序控制方式

​	==同步总线==

​	==异步总线==

### 系统总线的结构

单总线结构

​	结构：CPU、主存、I/O设备(通过I/O接口)都连接在一组总线上，允许I/O设备之间、I/O设备和CPU之间或I/O设备与主存之间直接交换信息。

​	注：单总线并不是指只有一根信号线，系统总线按传送信息的不同可以细分为地址总线、数据总线和控制总线。

​	优点：结构简单，成本低，易于接入新的设备。

​	缺点：带宽低、负载重，多个部件只能争用唯一的总线，且不支持并发传送操作。

双总线结构

​	结构：双总线结构有两条总线，一条是主存总线，用于CPU、主存和通道之间进行数据传送；另一条是I/O总线，用于多个外部设备与通道之间进行数据传送。

​	支持突然(猝发)传送：送出一个地址，收到多个地址连续的数据。

​	通道是具有特殊功能的处理器，能对I/O设备进行统一管理。通道程序放在主存中。

​	优点：将较低速的I/O设备从单总线上分离出来，实现存储器总线和I/O总线分离。

​	缺点：需要增加通道等硬件设备。

三总线结构

​	结构：三总线结构是在计算机系统各部件之间采用3条各自独立的总线来构成信息通路，这3条总线分别为主存总线、I/O总线和直接内存访问DMA总线。（DMA：Direct Memory Access,直接内存访问）

​		I/O总线	磁盘机是高速外设		打印机和显示器是低速外设

​	优点：提高了I/O设备的性能，使其更快地响应命令，提高系统吞吐量。

​	缺点：系统工作效率较低。

四总线结构简介

​	1.桥接器：用于连接不同的总线，具有数据缓冲、转换和控制功能。

​	2.靠近CPU的总线速度比较快。

​	3.每级总线的设计遵循总线标准。

### 本章小结

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081303983.png)

## 性能指标

1.总线的传输周期(总线周期)

​	一次总线操作所需的时间(包括申请阶段、寻址阶段、传输阶段和结束阶段)，通常由若干个总线时钟周期构成。

2.总线时钟周期

​	即机器的时钟周期。计算机有一个统一的时钟，以控制整个计算机的各个部件，总线也要受此时钟的控制。

3.总线的工作频率

​	总线上各种操作的频率，为总线周期的倒数。若总线周期 = N个时钟周期，则总线的工作频率 = 时钟频率 / N。实际上指一秒内传送几次数据。

4.总线的时钟频率

​	即机器的时钟频率，为时钟周期的倒数。若时钟周期为T，则时钟频率为1/T。实际上指一秒内有多少个时钟周期。

5.总线宽度

​	又称为总线位宽，它是总线上同时能够传输的数据位数，通常是指数据总线的根数，如32根称为32位(bit)总线。

6.总线带宽

​	可理解为总线的数据传输率，即单位时间内总线上可传输数据的位数，通常用每秒钟传送信息的字节数来衡量，单位可用字节 / 秒(B / S)表示。

​	总线带宽 = 总线工作频率 × 总线宽度(bit / s) = 总线工作频率 × (总线宽度 / 8)(B / S) = 总线宽度 / 总线周期(bit / s) = 总线宽度 / 8	/ 总线周期(B / S)

​	==注：总线带宽是指总线本身所能达到的最高传输速率。在计算实际的有效数据传输率时，要用实际传输的数据量除以耗时。==

7.总线复用

​	总线复用是指一种信号线在不同的时间传输不同的信息。可以使用较少的线传输更多的信息，从而节省了空间和成本。

8.信号线数

​	地址总线、数据总线和控制总线 3种总线数的总和称为信号线数。

## 总线仲裁

### 总线仲裁的基本概念

同一时刻只能有一个设备控制总线传输操作，可以有一个或多个设备从总线接收数据。

将总线上所连接的各类设备按其对总线有无控制功能分为：

​	主设备：获得总线控制权的设备

​	从设备：被主设备访问的设备，只能响应从主设备发来的各种总线命令。

为什么要仲裁？

​	总线作为一种共享设备，不可避免地会出现同一时刻有多个主设备竞争总线控制权的问题。

总线仲裁的定义：

​	多个主设备同时竞争主线控制权时，以某种方式选择一个主设备优先获得总线控制权称为总线仲裁。

总线仲裁分类：

​	集中仲裁方式 	链式查询方式、计数器定时查询方式、独立请求方式

​	分布仲裁方式

### 集中仲裁方式

工作流程：

​	1.主设备发出请求信号；

​	2.若多个主设备同事要使用总线，则由总线控制器的判优、仲裁逻辑按一定的优先等级顺序确定哪个主设备能使用总线；

​	3.获得总线使用权的主设备开始传送数据。

链式查询：

![image-20221031140431474](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304927.png)

​	“总线忙”信号的建立者是获得总线控制权的设备

​	优先级：

​		离总线控制器越近的部件，其优先级越高，离总线控制器越远的部件，其优先级越低。

​	链式查询方式优先级固定。

​	优点：只需很少几根控制线就能按一定优先次序实现总线控制，结构简单，扩充容易。

​	缺点：对硬件电路的故障敏感，并且优先级不能改变。当优先级高的部件频繁请求使用总线时，会使优先级较低的部件长期不能使用总线。

计数器查询方式

​	结构特点：用一个计数器控制总线使用权，相对链式查询方式多了一组设备地址线，少了一根总线响应线BG；它仍共用一根总线请求线。

​	设备地址线，当地址线上的计数值与请求使用总线设备的地址一致时，该设备获得总线控制权。同时，中止计数器的计数及查询。

​	当总线控制器收到总线请求信号，判断总线空闲时，计数器开始计数，计数值通过设备地址线发向各个部位。

​	优点：

​		1.计数初始值可以改变优先次序 计数每次从“0”开始，设备的优先级就按顺序排列，固定不变；计数从上一次的终点开始，此时设备使用总线的优先级相等；计数器的初值还可以由程序设置

​		2.对电路的故障没有链式敏感

​	缺点：

​		1.增加了控制线数，若设备有n个，则需[log~2~n] + 2条控制线

​		2.控制相对比链式查询相对复杂

独立请求方式

​		BR~i~:总线请求

​		BG~i~:总线允许

​	结构特点：每一个设备均有一对总线请求线BR~i~和总线允许线BG~i~。

​	BR~n~当总线上的部件需要使用总线时，经各自的总线请求线发送总线请求信号，在总线控制器中排队。

​	BG~n~当总线控制器按一定的优先次序决定批准某个部件的请求时，则给该部件发送总线响应信号。

​	优点：

​		1.响应速度快，总线允许信号BG直接从控制器发送到有关设备，不必在设备间传递或者查询。

​		2.对优先次序的控制相当灵活。

​	缺点：

​		1.控制线数量多，若设备有n个，则需要2n+1条控制线。其中+1为BS线，其用处为，用于设备向总线控制部件反馈已经使用完毕总线。

​		2.总线的控制逻辑更加复杂。

集中仲裁方式小结

![image-20221031190450572](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304431.png)

### 分布仲裁方式

特点：不需要中央仲裁器，每个潜在的主模块都有自己的仲裁器和仲裁号，多个仲裁器竞争使用总线。

当设备有总线请求时，它们就把各自唯一的仲裁号发送到共享的仲裁总线上；每个仲裁器将从仲裁总线上得到的仲裁号与自己的仲裁号进行比较；如果仲裁总线上的号优先级高，则它的总线请求不予响应，并撤销它的仲裁号；最后，获胜者的仲裁号保留在仲裁总线上。

### 本章小结

![image-20221031192203821](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304681.png)

## 总线操作和定时

### 总线传输的四个阶段

#### 总线周期的四个阶段

1.申请分配阶段：由需要使用总线的主模块(或主设备)提出申请，经总线仲裁机构决定将下一传输周期的总线使用权授予某一申请者。也可将此阶段细分为传输请求和总线仲裁两个阶段。

2.寻址阶段：获得使用权的主模块通过总线发出本次要访问的从模块的地址及有关命令，启动参与本次传输的从模块。

3.传输阶段：主模块和从模块进行数据交换，可单向或双向进行数据传送。

4.结束阶段：主模块的有关信息均从系统总线上撤除，让出总线使用权。

总线定时是指总线在双方交换数据的过程中需要时间上配合关系的控制，这种控制称为总线定时，它的实质是一种协议或规则

​	同步通信（同步定时方式）		由统一时钟控制数据传送

​	异步通信（异步定时方式）		采用应答方式，没有公共时钟标准

​	半同步通信										同步、异步结合

​	分离式通信										充分挖掘系统总线每瞬间的潜力

### 同步定时方式-读命令

系统采用一个统一的时钟信号来协调发送和接收双方的传送定时关系。

时钟产生相等的时间间隔，每个间隔构成一个总线周期。

在一个总线周期中，发送方和接收方可进行一次数据传送。

因为采用统一的时钟，每个部件或设备发送或接收信息都在固定的总线传送周期中，一个总线的传送周期结束，下一个总线传送周期开始。

优点：传送速度快，具有较高的传输速率；总线控制逻辑简单。

缺点：主从设备属于强制性同步；不能及时进行数据通信的有效性检验，可靠性较差。

同步通信适用于总线长度较短及总线所接部件的存取时间比较接近的系统。

### 异步定时方式

在异步定时方式中，没有统一的时钟，也没有固定的时间间隔，完全依靠传送双方相互制约的“握手”信号来实现定时控制。

主设备提出交换信息的“请求”信号，经接口传送到从设备；从设备接到主设备的请求后，通过接口向主设备发出“回答”信号。

根据“请求”和“回答”信号的撤销是否互锁，分为以下3种类型。

​	1.不互锁方式	==速度最快 可靠性最差==

​		主设备发出“请求”信号后，不必等到接到从设备的“回答”信号，而是经过一段时间，便撤销“请求”信号。

​		而从设备在接到“请求”信号后，发出“回答”信号，并经过一段时间，自动撤销“回答”信号。双方不存在互锁关系。

​	2.半互锁方式

​		主设备发出“请求”信号后，必须待接到从设备的“回答”信号后，才撤销“请求”信号，有互锁的关系。

​		而从设备在接到“请求”信号后，发出“回答”信号，但不必等待获知主设备的“请求”信号已经撤销，而是隔一段时间后自动撤销“回答”信号，不存在互锁关系。

​	3.全互锁方式	==最可靠 速度最慢==

​		主设备发出“请求”信号后，必须待从设备“回答”后，才撤销“请求”信号；

​		从设备发出“回答”信号，必须待获知主设备“请求”信号已撤销后，再撤销其“回答”信号。双方存在互锁关系。

优点：总线周期可变，能保证两个工作速度相差很大的部件或设备之间可靠地进行信息交换，自动适应时间的配合。

缺点：比同步控制方式稍复杂一些，速度比同步定时方式慢。

#### 异步定时方式-数据传输率

波特率：单位时间内传送的二进制数据的位数，单位用bps(位 / 秒)表示，记作波特

比特率：单位时间内传送二进制有效数据的位数，单位用bps表示，bps即bit / s

比特率 / 波特率 = 数据位数 / (数据位数 + 其它附加位位数)

每传送(1 + 1 + 7 + 1) = 10个二进制位，就传送了7个有效数据位

故有效数据传输率为1200 * 7/(1 + 7 + 1 + 1) = 840 bit/s

### 半同步通信

同步	发送方用系统时钟前沿发信号

​			接收方用系统时钟后沿判断、识别

异步	允许不同速度的模块和谐工作

半同步通信：统一时钟的基础上，增加一个“等待”响应信号wait

### 分离式通信

同步异步半同步通信的共同点：一个总线传输周期(以输入数据为例)

- 主模块发地址、命令											使用总线
- 从模块准备数据								                    不使用总线        总线空闲
- 从模块向主模块发数据                                        使用总线

分离式通信的一个总线传输周期

​	子周期1	主模块申请占用总线，使用完后放弃总线的使用权

​	子周期2	从模块申请占用总线，将各种信息送至总线上

特点：

​	1.各模块均有权申请占用总线

​	2.采用同步方式通信，不等对方回答

​	3.各模块准备数据时，不占用总线

​	4.总线利用率提高

### 本章小结

![image-20221101163223447](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304954.png)

## 总线标准

### 总线标准的基本概念

总线标准是国际上公布或推荐的互连各个模块的标准，它是把各种不同的模块组成计算机系统时必须遵守的规范。按总线标准设计的接口可视为通用接口，在接口的两端，任何一方只需根据总线标准的要求完成自身方面的功能要求，而无须了解对方接口的要求。

系统总线标准：ISA、EISA、VESA、PCI、PCI-Express等。

设备总线标准：IDE、AGP、RS-232C、USB、SATA、SCSI、PCMCIA等。

局部总线标准：在ISA总线和CPU总线之间增加的一级总线或管理层，如PCI、PCI-E、VESA、AGP等，可以节省系统的总带宽。

即插即用的作用是自动配置(低层)计算机中的板卡和其他设备，然后告诉对应的设备都做了什么。把物理设备和软件(设备驱动程序)相配合，并操作设备，在每个设备和它的驱动程序之间建立通信信道。

热插拔即带电插拔，热插拔功能就是允许用户在不关闭系统，不切断电源的情况下取出和更换损坏的硬盘、电源或板卡等部件，从而提高了系统对灾难的及时恢复能力、扩展性和灵活性等，例如一些面向高端应用的磁盘镜像系统都可以提供磁盘的热插拔功能。

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304278.png" alt="image-20221101164851488" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304133.png" alt="image-20221101164906812" style="zoom: 67%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304242.png" alt="image-20221101165233614" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081312702.png" alt="image-20221101165607327" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304633.png" alt="image-20221101170039504" style="zoom:67%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304830.png" alt="image-20221101170237017" style="zoom:67%;" />

### 设备总线标准

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304822.png" alt="image-20221101170343962" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304323.png" alt="image-20221101170731345" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081312014.png" alt="image-20221101171041639" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304642.png" alt="image-20221101171227579" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304503.png" alt="image-20221101171338098" style="zoom:50%;" />

### 本章小结

![image-20221101171402715](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304486.png)

![image-20221101171425755](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304577.png)

### 视频线标准

![image-20221101172000034](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304701.png)

# 第七章 I/O系统

![image-20221101172125053](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081304203.png)

## 基本概念

### I/O系统演变过程

1.早期	CPU和I/O串行工作，分散连接						主存	<--->	CPU	<--->	I/O系统

​	程序查询方式	由CPU通过程序不断查询I/O设备是否已做好准备，从而控制I/O设备与主机交换信息。

2.接口模块和DMA阶段	CPU和I/O并行工作，总线连接

​	中断方式	只在I/O设备准备就绪并向CPU发出中断请求时才予以响应。

​	DMA方式主存和I/O设备之间有一条直接数据通路，当主存和I/O设备交换信息时，无需调用中断服务程序。

3.具有I/O通道结构的阶段

​	在系统中设有通道控制部件，每个通道都挂接若干外设，主机在执行I/O命令时，只需启动有关通道，通道将执行通道程序，从而完成I/O操作。

4.具有I/O处理机的阶段

### I/O系统基本组成

一般来说，I/O系统由I/O软件和I/O硬件两部分构成

​	1.I/O软件	包括驱动程序、用户程序、管理程序、升级补丁等。

​		通常采用I/O指令和通道指令实现CPU和I/O设备的信息交换。

​			1）I/O指令	CPU指令的一部分

​				操作码(识别I/O指令)-命令码(做什么操作)-设备码(对哪个设备进行操作)

​			2）通道指令	通道自身的指令

​				指出数据的首地址、传送字数、操作命令

​				通道指令放在主存中

​				由CPU执行启动I/O设备的指令，由通道代替CPU对I/O设备进行管理

​	2.I/O硬件	包括外部设备、设备控制器和接口、I/O总线等。

​		主机	<--->	I/O接口	<--->	(外部设备)设备控制器	->	(外部设备)机、电、光、磁部分

​	I/O接口可以看作是两个部件之间的交接部分。		

### I/O方式简介

![image-20221101184746751](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305804.png)

### 本章小结

![image-20221101184807387](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305150.png)

## 外部设备-输入/输出设备

外部设备也称为外围设备，是除了主机以外的、能直接或间接与计算机交换信息的装置。

输入设备

​	用于向计算机系统输入命令和文本、数据等信息的部件。键盘和鼠标是最基本的输入设备。

输出设备

​	用于将计算机系统中的信息输出到计算机外部进行显示、交换等的部件。显示器和打印机是最基本的输出设备。

外存设备

​	是指除计算机内存及CPU缓存等以外的存储器。硬磁盘、光盘等是最基本的外存设备。

### 输出设备

显示器：

![image-20221101191849526](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081312370.png)

阴极射线管(CRT)显示器

​	CRT显示器主要由电子枪、偏转线圈、荫罩、高压石墨电极和荧光粉涂层及玻璃外壳5部分组成。具有可视角度大、无坏点、色彩还原度高、色度均匀、可调节的多分辨率模式、响应时间极短等目前LCD难以超过的优点。

液晶显示器(LCD)

​	原理：利用液晶的电光效应，由图像信号电压直接控制薄膜晶体管，再间接控制液晶分子的光学特性来实现图像的显示。

​	特点：体积小、重量轻、省电、无辐射、绿色环保、画面柔、不伤眼等。

LED(发光二极管)显示器

​	原理：通过控制半导体发光二极管进行显示，用来显示文字、图形、图像等各种信息。

LCD与LED是两种不同的显示技术，LCD是由液态晶体组成的显示屏，而LED则是由发光二极管组成的显示屏。与LCD相比，LED显示器在亮度、功耗、可视角度和刷新速率等方面都更具优势。

#### 显示器-CRT显示器

按显示信息内容不同可分为

​	字符显示器

​		显示字符的方法以点阵为基础。点阵是指由m×n个点组成的阵列。点阵的多少取决于显示字符的质量和字符窗口的大小。字符窗口是指每个字符在屏幕上所占的点数，它包括字符显示点阵和字符间隔。

​		将点阵存入由ROM构成的字符发生器中，在CRT进行光栅扫描的过程中，从字符发生器中依次读出某个字符的点阵，按照点阵中0和1代码不同控制扫描电子束的开或关，从而在屏幕上显示出字符。对应于每个字符窗口，所需显示字符的ASCII代码被存放在视频存储器VRAM中，以备刷新。

​	图形显示器

​		将所显示图形的一组坐标点和绘图命令组成显示文件存放在缓冲存储器中，缓存中的显示文件传送给矢量(线段)产生器，产生相应的模拟电压，直接控制电子束在屏幕上的移动。为了在屏幕上保留持久稳定的图像，需要按一定的频率对屏幕进行反复刷新。

​		这种显示器的优点是分辨率高且显示的曲线平滑。目前高质量的图形显示器采用这种随机扫描方式。缺点是当显示复杂图形时，会有闪烁感。

​	图像显示器

按扫描方式不同可分为

​	光栅扫描显示器、随机扫描显示器

#### 打印机

打印机是计算机的输出设备之一，用于将计算机处理结果打印在相关介质上。

按印字原理不同可分为

​	击打式打印机：利用机械动作使印字机构与色带和纸相撞而打印字符

​		优：设备成本低、印字质量好

​		缺：噪声大、速度慢

​	非击打式打印机：采用电、磁、光、喷墨等物理、化学方法来印刷字符

​		优：速度快、噪声小

​		缺：成本高

按打印机工作方式不同可分为

​	串行打印机：逐字打印、速度慢

​	行式打印机：逐行打印、速度快

按工作方式可分为

​	针式打印机

​		原理：在联机状态下，主机发出打印命令，经接口、检测和控制电路，间歇驱动纵向送纸和打印头横向移动，同时驱动打印机间歇冲击色带，在纸上打印出所需内容。

​		特点：针式打印机擅长“多层复写打印”，实现各种票据或蜡纸等的打印。它工作原理简单，造价低廉，耗材(色带)便宜，但打印分辨率和打印速度不够高。

​	喷墨式打印机

​		原理：带电的喷墨雾点经过电极偏转后，直接在纸上形成所需字形。彩色喷墨打印机基于三基色原理，即分别喷射三种颜色墨滴，按一定的比例混合出所要求的颜色。

​		特点：打印噪声小，可实现高质量彩色打印，通常打印速度比针式打印机快；但防水性差，高质量打印需要专用打印纸。

​	激光打印机

​		原理：计算机输出的二进制信息，经过调制后的激光束扫描，在感光鼓上形成潜像，再经过显影、转印和定影，便在纸上得到所需的字符或图像。

​		特点：打印质量高、速度快、噪声小、处理能力强；但耗材多、价格较贵、不能复写打印多份，且对纸张的要求高。激光打印机是将激光技术和电子显像技术相结合的产物。感光鼓(也称为硒鼓)是激光打印机的核心部件。

#### 本章小结

![image-20221101201226917](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305872.png)

### 外存储器

计算机的外存储器又称为辅助存储器，目前主要使用磁表面存储器。

所谓“磁表面存储”，是指把某些磁性材料薄薄地涂在金属铝或塑料表面上作为载磁体来存储信息。磁盘存储器、磁带存储器和磁鼓存储器均属于磁表面存储器。

磁表面存储器的优点：

​	1.存储容量大，位价格低；

​	2.记录介质可以重复使用；

​	3.记录信息可以长期保存而不丢失，甚至可以脱机存档；

​	4.非破坏性读出，读出时不需要再生。

磁表面存储器的缺点：

​	1.存取速度慢；

​	2.机械结构复杂；

​	3.对工作环境要求较高。

原理：当磁头和磁性记录介质有相对运动时，通过电磁转换完成读/写操作。

编码方法：按某种方案(规律)，把一连串的二进制信息变换成存储介质磁层中一个磁化翻转状态的序列，并使读/写控制电路容易、可靠地实现转换。

磁记录方式：通常采用调频制(FM)和改进型调频制(MFM)的记录方式。

外存储器既可以作为输入设备，也可以作为输出设备。(既可以存数据，也可以读数据)

#### 磁盘存储器

1.磁盘设备的组成

​	1）存储区域

​		一块硬盘含有若干个记录面，每个记录面划分为若干条磁道，而每条磁道又划分为若干个扇区，扇区(也称块)是磁盘读写的最小单位，也就是说磁盘按块存取。

​	磁头数：即记录面数，表示硬盘总共有多少个磁头，磁头用于读取/写入盘片上记录面的信息，一个记录面对应一个磁头。

​	柱面数：表示硬盘每一面盘片上有多少条磁道。在一个盘组中，不同记录面的相同编号(位置)的诸磁道构成一个圆柱面。

​	扇区数：表示每一条磁道上有多少个扇区。

​	2）硬盘存储器

​		硬盘存储器由磁盘驱动器、磁盘控制器和盘片组成。

​	磁盘驱动器：核心部件是磁头组件和盘片组件，温彻斯特盘是一种可移动头固定盘片的硬盘存储器。

​	磁盘控制器：是硬盘存储器和主机的接口，主流的标准有IDE、SCSI、SATA等。

2.磁盘的性能指标

​	1）磁盘的容量：一个磁盘所能存储的字节总数称为磁盘容量。磁盘容量有非格式化容量和格式化容量之分。

​		非格式化容量是指磁记录表面可以利用的磁化单元总数。

​		格式化容量是指按照某种特定的记录格式所能存储信息的总量。

​	2）记录密度：记录密度是指盘片单位面积上记录的二进制的信息量，通常以道密度、位密度和面密度表示。

​		道密度是沿磁盘半径方向单位长度上的磁道数；

​		位密度是磁道单位长度上能记录的二进制代码位数；

​		面密度是位密度和道密度的乘积。

​				注意：磁盘所有磁道记录的信息量一定是相等的，并不是圆越大信息越多，故每个磁道的位密度都不同。

​	3）平均存取时间：

​		平均存取时间 = 寻道时间(磁头移动到目的磁道) + 旋转延迟时间(磁头定位到所在扇区) + 传输时间(传输数据所花费的时间)

​	4）数据传输率：磁盘存储器在单位时间内向主机传送数据的字节数，称为数据传输率。

​		假设磁盘转数为r(转 / 秒)，每条磁道容量为N个字节，则数据传输率为D~r~ = r N。

3.磁盘地址

​	主机向磁盘控制器发送寻址信息，磁盘的地址一般如图所示：

​		驱动器号	-	柱面(磁道)号	-	盘面号	-	扇区号

​	若系统中有4个驱动器，每个驱动器带一个磁盘，每个磁盘256个磁道、16个盘面，每个盘面划分为16个扇区，则每个扇区地址要18位二进制代码；

​		驱动器号（2bit）	-	柱面（磁道）号（8bit）	-	盘面号（4bit）	-	扇区号（4bit）

4.硬盘的工作过程

​	硬盘的主要操作是寻址、读盘、写盘。每个操作都对应一个控制字，硬盘工作时，第一步是取控制字，第二步是执行控制字。

​	硬盘属于机械式部件，其读写操作是串行的，不可能在同一时刻既读又写，也不可能在同一时刻读两组数据或写两组数据。

#### 磁盘阵列

RAID(廉价冗余磁盘阵列)是将多个独立的物理磁盘组成一个独立的逻辑盘，数据在多个物理盘上分割交叉存储、并行访问，具有更好的存储性能、可靠性和安全性。

RAID的分级如下所示。在RAID1~RAID5的几种方案中，无论何时有磁盘损坏，都可以随时拔出受损的磁盘再插入好的磁盘，而数据不会损坏。

RAID0：无冗余和无校验的磁盘阵列。		RAID0把连续多个数据块交替地存放在不同物理磁盘的扇区中，几个磁盘交叉并行读写，不仅扩大了存储容量，而且提高了磁盘数据存取速度，但RAID0没有容错能力。

RAID1：镜像磁盘阵列。			RAID1是为了提高可靠性，使两个磁盘同时进行读写，互为备份，如果一个磁盘出现故障，可从另一磁盘中读出数据。两个磁盘当一个磁盘使用，意味着容量减少一半。

RAID2：采用纠错的海明码的磁盘阵列。

RAID3：位交叉奇偶校验的磁盘阵列。

RAID4：块交叉奇偶校验的磁盘阵列。

RAID5：无独立校验的奇偶校验磁盘阵列。

RAID通过同时使用多个磁盘，提高了传输率；通过在多个磁盘上并行存取来大幅提高存储系统的数据吞吐量；通过镜像功能，可以提高安全可靠性；通过数据校验，可以提供容错能力。

#### 光盘存储器

光盘存储器是利用光学原理读/写信息的存储装置，它采用聚焦激光束对盘式介质以非接触的方式记录信息。

​	光盘存储系统	->	光盘片	->	透明的聚合物基片、铝合金反射层、漆膜保护层的固盘

​								->	光盘驱动器、光盘控制器、光盘驱动软件

特点：存储密度高、携带方便、成本低、容量大、存储期限长、容易保存等。

光盘的类型如下：

​	CD-ROM：只读型光盘，只能读出其中内容，不能写入或修改。

​	CD-R：只可写入一次信息，之后不可修改。

​	CD-RW：可读可写光盘，可以重复读写。

​	DVD-ROM：高容量的CD-ROM，DVD表示通用数字化多功能光盘。

#### 固态硬盘

​	在微小型高档笔记本电脑中，采用高性能Flash Memory作为硬盘来记录数据，这种“硬盘”称固态硬盘。

​	固态硬盘除了需要Flash Memory外，还需要其他硬件和软件的支持。

​	注：闪存(Flash Memory)是在E2PROM的基础上发展起来的，本质上是只读存储器。

#### 本章小结

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305014.png)

## I/O接口

接口可以看作是两个部件之间的交接部分。

### I/O接口的功能

I/O接口（I/O控制器）是主机和外设之间的交接界面，通过接口可以实现主机和外设之间的信息交换。

接口的功能（要解决的问题）

1.实现主机和外设的通信联络控制

2.进行地址译码和设备选择

3.实现数据缓冲

4.信号格式的转换

5.传送控制命令和状态信息

接口的功能（具体操作）

1.设备选址

2.传送命令

3.传送数据

4.反映设备状态

### I/O接口的基本结构

![image-20221102144924394](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305780.png)

![image-20221102145443990](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305866.png)

### 接口与端口

接口interface	->	端口Port	->	数据端口	读&写、控制端口	写、状态端口	读

​							->	控制逻辑

I/O端口是指接口电路中可以被CPU直接访问的寄存器。

如何访问I/O端口？

​	I/O端口要想能够被CPU访问，必须要有端口地址，每一个端口都对应着一个端口地址。

### I/O端口及其编址

1.统一编址

​	把I/O端口当做存储器的单元进行地址分配，用统一的访存指令就可以访问I/O端口，又称存储器映射方式。

​	靠不同的地址码区分内存和I/O设备，I/O地址要求相对固定在地址的某部分。

​	优点：不需要专门的输入/输出指令，可使CPU访问I/O的操作更灵活、更方便，还可使端口有较大的编址空间。

​	缺点：端口占用了存储器地址，使内存容量变小，而且利用存储器编址的I/O设备进行数据输入/输出操作，执行速度较慢。

2.独立编址

​	I/O端口地址与存储器地址无关，独立编址CPU需要设置专门的输入/输出指令访问端口，又称I/O映射方式。

​	靠不同的指令区分内存和I/O设备。

​	优点：输入/输出指令与存储器指令有明显区别，程序编址清晰，便于理解。

​	缺点：输入/输出指令少，一般只能对端口进行传送操作，尤其需要CPU提供存储器读/写、I/O设备读/写两组控制信号，增加了控制的复杂性。

### I/O接口的类型

按数据传送方式可分为：

​	并行接口：一个字节或一个字所有位同时传送。

​	串行接口：一位一位地传送。

​	注：这里所说的数据传送方式指的是外设和接口一侧的传送方式，而在主机和接口一侧，数据总是并行传送的。接口要完成数据格式转换。

按主机访问I/O设备的控制方式可分为：

​	程序查询接口、中断接口、DMA接口

按功能选择的灵活性可分为：

​	可编程接口、不可编程接口

### 本章小结

![image-20221102151106867](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305306.png)

## I/O方式-程序查询方式

#### I/O方式简介

![image-20221102154521222](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305297.png)

#### 程序查询方式流程图

![image-20221102154942767](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305506.png)

#### 程序查询方式接口结构

![image-20221102155204727](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305508.png)

#### 本章小结

![image-20221102155958635](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305939.png)

## 中断方式

程序中断方式	->	中断系统	->	中断的基本概念、工作流程（->中断请求、中断响应、中断处理）、单重中断与多重中断

​							->	程序中断方式	->	工作流程、CPU占用情况

### 中断的基本概念

程序中断是指计算机执行现行程序的过程中，出现某些急需处理的异常情况或特殊请求，CPU暂时中止现行程序，而转去对这些异常情况或特殊请求进行处理，在处理完毕后CPU又自动返回到现行程序的断点处，继续执行原程序。

工作流程：

​	1.中断请求

​		中断源向CPU发送中断请求信号。

​	2.中断响应

​		响应中断的条件

​		中断判优：多个中断源同时提出请求时通过中断判优逻辑响应一个中断源。

​	3.中断处理

​		中断隐指令。

​		中断服务程序。

### 中断请求的分类

![image-20221102162319036](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305510.png)

外中断也分为两种

​	1.非屏蔽中断：关中断(中断标志位IF = 0)时也会被响应

​	2.可屏蔽中断：关中断时不会被响应

​	IF：Interrupt Flag,存在PSW中

![image-20221102163159086](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305376.png)

### 中断请求标记

每个中断源向CPU发出中断请求的时间是随机的。

为了记录中断事件并区分不同的中断源，中断系统需对每个中断源设置中断请求标记触发器INTR，当其状态为“1”时，表示中断源有请求。

这些触发器可组成中断请求标记寄存器，该寄存器可集中在CPU中，也可分散在各个中断源中。

对于外中断，CPU是在统一的时刻即每条指令执行阶段结束前向接口发出中断查询信号（对于执行时间很长的指令，可在执行过程中设置若干个“查询断点”），以获取I/O的中断请求，也就是说，CPU响应中断的时间是在每条指令执行阶段的结束时刻。

CPU响应中断必须满足以下3个条件：

​	1.中断源有中断请求。

​	2.CPU允许中断即开中断。

​	3.一条指令执行完毕，且没有更紧迫的任务。

### 中断判优-实现

中断判优既可以用硬件实现，也可用软件实现：

硬件实现是通过硬件排队器实现的，它既可以设置在CPU中，也可以分散在各个中断源中；软件实现是通过查询程序实现的。

### 中断判优-优先级设置

1.硬件故障中断属于最高级，其次是软件中断；

2.非屏蔽中断优于可屏蔽中断；

3.DMA请求优于I/O设备传送的中断请求；

4.高速设备优于低速设备；

5.输入设备优于输出设备；

6.实时设备优于普通设备。

### 中断处理过程

进入终端服务程序的方法是把该程序第一条指令的地址放入PC

回到主程序的方法是把K+1放入PC

软件无法完成保存PC的任务，应由硬件实现：中断隐指令

#### 中断隐指令

中断隐指令的主要任务：

​	1.关中断。在中断服务程序中，为了保护中断现场（即CPU主要寄存器中的内容）期间不被新的中断所打断，必须关中断，从而保证被中断的程序在中断服务程序执行完毕之后能接着正确地执行下去。

​	2.保存断点。为了保证在中断服务程序执行完毕后能正确地返回到原来的程序，必须将原来程序的断点（即程序计数器（PC）的内容）保存起来。可以存入堆栈，也可以存入指定单元。

​	3.引出中断服务程序。引出中断服务程序的实质就是取出中断服务程序的入口地址并传送给程序计数器(PC)。

​		软件查询法、硬件向量法

#### 中断服务程序

中断服务程序的主要任务：

​	1.保护现场

​		一是保存程序断点(PC)，已由中断隐指令完成；

​		二是保存通用寄存器和状态寄存器的内容，由中断服务程序完成。

​		可以使用堆栈，也可以使用特定存储单元。

​	2.中断服务(设备服务)

​		主体部分，如通过程序控制需打印的字符代码送入打印机的缓冲存储器中。

​	3.恢复现场

​		通过出栈指令或取数指令之前把之前保存的信息送回寄存器中。

#### 中断处理过程

![image-20221102174001572](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305518.png)

#### 单重中断与多重中断

![image-20221102174137177](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305274.png)

#### 中断屏蔽技术

中断屏蔽技术主要用于多重中断，CPU要具备多重中断的功能，须满足下列条件。

​	1.在中断服务程序中提前设置开中断指令。

​	2.优先级别高的中断源有权中断优先级别低的中断源。

​	每个中断源都有一个屏蔽触发器，1表示屏蔽该中断源的请求，0表示可以正常申请，所有屏蔽触发器组合在一起，便构成一个屏蔽字寄存器，屏蔽字寄存器的内容称为屏蔽字。

屏蔽字设置的规律：

​	1.一般用‘1’表示屏蔽，‘0’表示正常申请。

​	2.每个中断源对应一个屏蔽字(在处理该中断源的中断服务程序时，屏蔽寄存器中的内容为该中断源对应的屏蔽字)。

​	3.屏蔽字中‘1’越多，优先级越高。每个屏蔽字中至少有一个‘1’(至少要能屏蔽自身的中断)。

### 本章小结

![](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305157.png)

## 程序中断方式

程序中断的作用如下：

​	1.实现CPU和I/O设备的并行工作。

​	2.处理硬件故障和软件错误。

​	3.实现人机交互，用户干预机器需要用到中断系统。

​	4.实现多道程序、分时操作，多道程序的切换需借助于中断系统。

​	5.实时处理需要借助中断系统来实现快速响应。

​	6.实现应用程序和操作系统(管态程序)的切换，称为“软中断”。

​	7.多处理器系统中各处理器之间的信息交流和任务切换。

![image-20221102181442358](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081305986.png)

![image-20221102182455073](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306880.png)

## DMA方式

![image-20221102182606849](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306074.png)

### DMA控制器

每准备好一个数据都要中断CPU，由CPU运行中断服务程序来完成一次传送

磁盘机、磁带机等高速设备需要大批量的数据传送->CPU大量时间用于中断服务

由硬件实现控制大批量的数据传送->DMA控制器

在DMA方式中，当I/O设备需要进行数据传送时，通过DMA控制器(DMA接口)向CPU提出DMA传送请求，CPU响应之后将让出系统总线，由DMA控制器接管总线进行数据传送。其功能有：

​	1.接受外设发出的DMA请求，并向CPU发出总线请求。

​	2.CPU响应此总线请求，发出总线响应信号，接管总线控制权，进入DMA操作周期。

​	3.确定传送数据的主存单元地址及长度，并能自动修改主存地址计数和传送长度计数。

​	4.规定数据在主存和外设间的传送方向，发出读写等控制信号，执行数据传送操作。

​	5.向CPU报告DMA操作的结束。

PS：1，2步为数据传送前，3.4步为数据传送时，5为数据传送后。

![image-20221102183910892](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306544.png)

### DMA传送过程

![image-20221102184425516](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306610.png)

![image-20221102184319288](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306956.png)

CPU和DMA可能出现访问主存的冲突。

主存和DMA控制器之间有一条数据通路，因此主存和I/O设备之间交换信息时，不通过CPU。但当I/O设备和CPU同时访问主存时，可能发生冲突，为了有效地使用主存，DMA控制器与CPU通常采用以下3种方法使用主存。

​	1.停止CPU访问主存	

​		控制简单、CPU处于不工作状态或保持状态，未充分发挥CPU对主存的利用率

​	2.DMA与CPU交替访存

​		一个CPU周期，分为C~1~和C~2~两个周期：一个专供CPU访存，一个专供DMA访存

​		不需要总线使用权的申请、建立和归还过程，硬件逻辑更为复杂

​	3.周期挪用(周期窃取，指存取周期)

​		DMA访问主存有三种可能：

​			CPU此时不访存(不冲突)

​			CPU正在访存(存取周期结束让出总线)

​			CPU和DMA同时请求访存(I/O访存优先)

### DMA方式的特点

主存和DMA接口之间有一条直接数据通路。

由于DMA方式传送数据不需要经过CPU，因此不必中断现行程序，I/O与主机并行工作，程序和传送并行工作。

DMA方式具有下列特点：

​	1.它使主存与CPU的固定联系脱钩，主存既可被CPU访问，又可被外设访问。

​	2.在数据块传送时，主存地址的确定、传送数据的计数等都由硬件电路直接实现。

​	3.主存中要开辟专用缓冲区，及时供给和接收外设的数据。

​	4.DMA传送速度快，CPU和外设并行工作，提高了系统效率。

​	5.DMA在传送开始前要通过程序进行预处理，结束后要通过中断方式进行后处理。

![image-20221102185536824](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306585.png)

### DMA方式与中断方式

![image-20221102185644066](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202303081306756.png)

### 本章小结

![image-20221102190516602](https://cdn.jsdelivr.net/gh/PopuDiver/Typora-MapDepot/Typora-MapDepot202212030934691.png)
